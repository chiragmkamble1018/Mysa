<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rain Soundscape Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for sound generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #374151; /* Dark Slate Gray */
            color: #d1d5db;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .rain-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to go through to the button */
        }
        .raindrop {
            position: absolute;
            width: 2px;
            height: 15px;
            background: rgba(147, 197, 253, 0.6); /* Light Blue/Gray */
            opacity: 0;
            animation: rain-fall linear infinite;
        }
        @keyframes rain-fall {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    
    <div id="rain-container" class="rain-container"></div>

    <div class="z-10 p-6 md:p-8 rounded-xl text-center backdrop-blur-md bg-white/20 shadow-2xl max-w-xl">
        <h1 class="text-3xl font-extrabold text-white mb-2">Rain Soundscape</h1>
        <p class="text-gray-300 mb-8">Click start and let the ambient sounds wash over you.</p>

        <div class="flex flex-col items-center space-y-4">
             <button id="start-btn" class="px-8 py-4 bg-indigo-500 text-white text-xl font-bold rounded-full shadow-lg hover:bg-indigo-600 transition duration-300">
                Start Soundscape
            </button>
            
            <div id="volume-control" class="flex items-center space-x-3 w-full max-w-xs hidden">
                <span class="text-gray-300">Volume:</span>
                <input type="range" id="volume-slider" min="-30" max="0" value="-10" step="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>
    </div>

    <script type="module">
        const startBtn = document.getElementById('start-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeControl = document.getElementById('volume-control');
        const rainContainer = document.getElementById('rain-container');
        
        let isPlaying = false;
        let noise; // Tone.js Noise instance
        let feedbackDelay; // Tone.js Delay for rain sound
        let reverb; // Tone.js Reverb for space

        // --- SOUND SETUP (Tone.js) ---

        function setupSound() {
            // 1. Reverb: Gives the sound space and depth
            reverb = new Tone.Reverb(2).toDestination();
            reverb.wet.value = 0.5; // Moderate wetness (mix)

            // 2. Simple Delay (Feedback): Gives the sound a repeating, natural echo effect (like rain on a roof)
            feedbackDelay = new Tone.FeedbackDelay("8n", 0.5).connect(reverb);
            feedbackDelay.delayTime.value = 0.25; 

            // 3. Noise Source (White Noise): The base "rain" sound
            noise = new Tone.Noise("white").connect(feedbackDelay).start();
            noise.volume.value = -10; // Start at a low volume
            noise.type = 'pink'; // Pink noise sounds more natural/deeper than white
        }

        // --- RAIN VISUALS ---

        function createRaindrop() {
            const drop = document.createElement('div');
            drop.classList.add('raindrop');
            drop.style.left = ${Math.random() * 100}vw;
            drop.style.animationDuration = ${Math.random() * 1 + 0.5}s;
            drop.style.animationDelay = ${Math.random() * 5}s;
            drop.style.height = ${Math.random() * 10 + 10}px;
            drop.style.width = ${Math.random() * 1.5 + 1}px;
            rainContainer.appendChild(drop);

            // Remove drop after animation to prevent DOM buildup
            drop.addEventListener('animationend', () => {
                drop.remove();
            });
        }

        function startRainVisuals() {
            // Continuously create new raindrops
            const dropCreator = setInterval(() => {
                if (isPlaying) createRaindrop();
            }, 50); // Control the density of the rain
            return dropCreator;
        }


        // --- CONTROL HANDLERS ---

        function togglePlayback() {
             // Must call Tone.start() on first user interaction for audio context
            if (Tone.context.state !== 'running') {
                Tone.start();
            }

            if (isPlaying) {
                // STOP
                noise.stop();
                isPlaying = false;
                startBtn.textContent = 'Start Soundscape';
                startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                startBtn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
                volumeControl.classList.add('hidden');

            } else {
                // START
                noise.start();
                isPlaying = true;
                startBtn.textContent = 'Stop Soundscape';
                startBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                startBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                volumeControl.classList.remove('hidden');
            }
        }
        
        // Volume adjustment
        volumeSlider.addEventListener('input', (e) => {
            // Set noise volume directly from slider value (Tone.js uses decibels)
            noise.volume.value = parseFloat(e.target.value);
        });

        // Initialize and setup
        setupSound();
        startRainVisuals(); // Visuals can run constantly even if sound is off
        startBtn.addEventListener('click', togglePlayback);
    </script>
</body>
</html>