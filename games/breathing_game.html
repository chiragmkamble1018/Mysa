<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calm Breathing Visualizer</title>
    <!-- Load Tailwind CSS for modern aesthetics -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* Custom Styles for the Calming Visualizer */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Soft background, consistent with dashboard */
        }
        .breathing-sphere {
            width: 200px;
            height: 200px;
            background-color: #6366f1; /* Indigo - primary color */
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.4);
            border-radius: 50%;
            transition: all 4s ease-in-out; /* Smooth transition base */
        }

        /* Animation States controlled by JavaScript */
        .breathe-in {
            transform: scale(1.5);
            transition-duration: 4s;
            background-color: #4f46e5;
            box-shadow: 0 0 60px rgba(79, 70, 229, 0.6);
        }
        .breathe-out {
            transform: scale(1);
            transition-duration: 6s;
            background-color: #6366f1;
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.4);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="max-w-xl w-full text-center bg-white p-8 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-2">Guided Calm Breathing</h1>
        <p class="text-gray-500 mb-8">Follow the sphere's movement to regulate your breath.</p>

        <!-- Breathing Sphere and Text Prompt -->
        <div class="flex flex-col items-center justify-center h-80">
            <div id="sphere" class="breathing-sphere flex items-center justify-center text-white text-3xl font-bold">
                <span id="prompt-text">Ready?</span>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="mt-8">
            <button id="start-btn" class="px-8 py-4 bg-indigo-500 text-white text-xl font-bold rounded-full shadow-lg hover:bg-indigo-600 transition duration-300">
                Start Session
            </button>
            <p id="timer-text" class="text-lg text-gray-700 mt-4 hidden">Time Elapsed: 0:00</p>
        </div>

        <!-- Instructions Modal (instead of alert) -->
        <div id="message-box" class="mt-6 p-4 bg-yellow-100 text-yellow-700 rounded-lg hidden">
            <p id="message-content"></p>
        </div>
    </div>

    <script type="module">
        // --- CONSTANTS ---
        const INHALE_DURATION_MS = 4000;
        const EXHALE_DURATION_MS = 6000;

        // --- DOM ELEMENTS ---
        const sphere = document.getElementById('sphere');
        const promptText = document.getElementById('prompt-text');
        const startBtn = document.getElementById('start-btn');
        const timerText = document.getElementById('timer-text');
        const messageBox = document.getElementById('message-box');
        const messageContent = document.getElementById('message-content');
        
        // --- STATE AND CONTROL ---
        let isRunning = false;
        let animationInterval;
        let sessionTimer;
        let elapsedTime = 0;

        // --- UI UTILITIES ---
        function showMessage(message, type = 'info') {
            messageContent.textContent = message;
            messageBox.classList.remove('hidden');
            
            // Apply color classes based on type (simple implementation)
            messageBox.className = mt-6 p-4 rounded-lg;
            if (type === 'success') {
                 messageBox.classList.add('bg-green-100', 'text-green-700');
            } else if (type === 'error') {
                 messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                 messageBox.classList.add('bg-yellow-100', 'text-yellow-700');
            }
        }
        
        function hideMessage() {
            messageBox.classList.add('hidden');
        }


        // --- CORE GAME LOGIC ---

        // Function to handle the Inhale phase
        function inhalePhase() {
            // Apply CSS class for expansion and 4s transition
            sphere.className = 'breathing-sphere breathe-in';
            promptText.textContent = 'Breathe In';
            
            // Set timeout for the next phase (Exhale)
            setTimeout(exhalePhase, INHALE_DURATION_MS);
        }

        // Function to handle the Exhale phase
        function exhalePhase() {
            // Apply CSS class for contraction and 6s transition
            sphere.className = 'breathing-sphere breathe-out';
            promptText.textContent = 'Breathe Out';
        }
        
        // Main function to start the loop
        function startBreathingLoop() {
            // Start the first phase (Inhale) immediately
            inhalePhase();
            
            // Set up a recurring interval for the entire cycle
            // Total cycle duration is 4s Inhale + 6s Exhale = 10s
            animationInterval = setInterval(inhalePhase, INHALE_DURATION_MS + EXHALE_DURATION_MS);
        }

        // Timer update function
        function updateTimer() {
            elapsedTime++;
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            
            const formattedTime = ${minutes}:${seconds < 10 ? '0' : ''}${seconds};
            timerText.textContent = Time Elapsed: ${formattedTime};
        }
        
        // --- CONTROL HANDLERS ---
        
        function startSession() {
            if (isRunning) {
                // Stop the session
                isRunning = false;
                clearInterval(animationInterval);
                clearInterval(sessionTimer);
                
                startBtn.textContent = 'Start Session';
                startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                startBtn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
                
                promptText.textContent = 'Finished';
                sphere.className = 'breathing-sphere'; // Reset visual
                
                showMessage(Session ended after ${timerText.textContent.replace('Time Elapsed: ', '')}. Great work!, 'success');
                
            } else {
                // Start the session
                isRunning = true;
                elapsedTime = 0;
                hideMessage();
                
                startBtn.textContent = 'Stop Session';
                startBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                startBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                
                timerText.classList.remove('hidden');
                
                startBreathingLoop();
                sessionTimer = setInterval(updateTimer, 1000);
            }
        }

        // --- INITIALIZATION ---
        startBtn.addEventListener('click', startSession);

        // Initial setup prompt
        promptText.textContent = 'Press Start';
    </script>
</body>
</html>